---
- name: Import repositories GPG keys
  become: true
  rpm_key:
    state: present
    key: "{{ item.gpg_url }}"
  loop: "{{ fedora_repositories }}"

- name: Add repositories
  become: true
  yum_repository:
    name: "{{ item.name }}"
    description: "{{ item.description }}"
    baseurl: "{{ item.url }}"
    gpgkey: "{{ item.gpg_url }}"
    gpgcheck: "{{ item.gpg_check | bool }}"
    enabled: yes
  loop: "{{ fedora_repositories }}"

- name: Import RPM Fusion Free GPG key
  become: true
  rpm_key:
    state: present
    key: https://rpmfusion.org/keys?action=AttachFile&do=get&target=RPM-GPG-KEY-rpmfusion-free-{{ ansible_distribution | lower }}-2020

- name: Install RPM Fusion Free
  become: true
  dnf:
    name: https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ansible_distribution_major_version}}.noarch.rpm
    state: present

- name: Install command line tools in Fedora
  become: true
  dnf:
    name:
      - alacritty
      - autorandr
      - bat
      - chromium
      - conky
      - docker-ce
      - docker-ce-cli
      - containerd.io
      - docker-buildx-plugin
      - docker-compose-plugin
      - dunst
      - exa
      - fd-find
      - feh
      - firefox
      - golang
      - golang-x-tools-gopls
      - helm
      - htop
      - i3
      - ImageMagick
      - jq
      - keepassxc
      - kubectl
      - neofetch
      - neovim
      - picom
      - polybar
      - python3-pip
      - ripgrep
      - rofi
      - rust
      - rustfmt
      - sublime-text
      - terraform
      - tig
      - tmux
      - unzip
    state: present

- name: Install pywal
  become: yes
  pip:
    name: pywal
    executable: pip3

- name: Download AWS CLI
  get_url: url=https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip dest=/tmp/awscliv2.zip
  register: aws_cli_download

- name: Unarchive AWS CLI Installer
  unarchive: src=/tmp/awscliv2.zip dest=/tmp copy=no creates=/tmp/aws
  when: aws_cli_download.changed
  register: aws_cli_unarchive

- name: Install AWS CLI
  become: yes
  shell: /tmp/aws/install --update
  args:
    creates: /usr/local/bin/aws
  when: aws_cli_unarchive.changed
